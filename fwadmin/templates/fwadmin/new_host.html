{% extends "base.html" %}
{% load i18n %}
{% load url from future %}

{% block content %}

<div class="page-header">
  <h1>{% trans "Create a new Host" %}</h1>
</div>

{% if form.errors %}
<p style="color: red;">
 {% blocktrans %} "Please correct the error{{ form.errors|pluralize }} below."
 {% endblocktrans %}
</p>
{% endif %}

<form action="" method="post">
  {% csrf_token %}
  {% for field in form %}
  <div class="{{ field.id_for_label }}">
    {{ field.errors }}
    {{ field.label_tag }} {{ field }}
    {% if field.id_for_label == "id_ip" %}
      <button id="gethostbyname">{% trans "Resolve" %}</button>
    {% endif %}
  </div>
  {% endfor %}
  <input class="btn" type="submit" value="{% trans "Create" %}">
</form>

<!-- multiple IPs dialog -->
<div class="modal hide" id="modalIPSelectionDialog" tabindex="-1" role="dialog" aria-labelledby="modalIPSelectionDialogLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="modalIPSelectionDialogLabel">{% trans "Select IP" %}</h4>
      </div>
      <div class="modal-body">
        {% trans "Please select a IP from the list: " %}
        <select id="ip_list">
        </select>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Cancel" %}</button>
        <button id="button_select_ip" type="button" class="btn btn-primary">{% trans "OK" %}</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script type="text/javascript">                                         
$(document).ready(function(){

  $("#button_select_ip").on("click", function() {
     $('#id_ip').val($('#ip_list').find(":selected").text());
     $('#modalIPSelectionDialog').modal('hide');     
  });

  $("#gethostbyname").on("click", function() {
     var hostname = $("#id_ip").val()
     var url = "{% url 'fwadmin:gethostbyname' 'xxxyyy' %}".replace("xxxyyy", hostname)
     $.getJSON(url, function( data ) {
        if(data.length === 1) {
          $("#id_ip").val(data[0])
        } else {
          $('#ip_list').empty()
          data.forEach(function(item) {
            $('#ip_list').append($("<option></option").attr("value", item).text(item));
          });
          $('#modalIPSelectionDialog').modal({});
        }
     });
     return false;
  });

});
 </script>   


{% endblock %}
